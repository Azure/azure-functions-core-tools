parameters:
  runtimes:
    - min.win-arm64
    - min.win-x86
    - min.win-x64
    - linux-x64
    - osx-x64
    - osx-arm64
    - win-x86
    - win-x64
    - win-arm64

steps:
  - pwsh: |
      eng/scripts/download-templates.ps1 -OutputPath ./artifacts
    displayName: 'Download templates'

  - task: DotNetCoreCLI@2
    displayName: 'Restore NuGet packages'
    inputs:
      command: 'restore'
      projects: 'Azure.Functions.Cli.sln'
      feedsToUse: 'config'
      nugetConfigPath: '$(Build.SourcesDirectory)/NuGet.config'

  - task: PowerShell@2
    displayName: 'Run publish script'
    inputs:
      filePath: 'eng/scripts/build/publish-cli.ps1'
      arguments: |
        -projectFile 'src\Cli\func\Azure.Functions.Cli.csproj'
        -outputDirRoot '$(Build.ArtifactStagingDirectory)\artifacts'
        -commitHash '$(Build.SourceVersion)'
        -integrationBuildNumber '$(Build.BuildNumber)'
      pwsh: true