parameters:
  runtimes:
    - min.win-arm64
    - min.win-x86
    - min.win-x64
    - linux-x64
    - osx-x64
    - osx-arm64
    - win-x86
    - win-x64
    - win-arm64

steps:
  - pwsh: |
      eng/scripts/download-templates.ps1 -OutputPath ./artifacts
    displayName: 'Download templates'

  - task: DotNetCoreCLI@2
    displayName: 'Restore NuGet packages'
    inputs:
      command: 'restore'
      projects: 'Azure.Functions.Cli.sln'
      feedsToUse: 'config'
      nugetConfigPath: '$(Build.SourcesDirectory)/NuGet.config'

  - pwsh: |
      ./eng/scripts/build/publish-cli.ps1 `
        -projectFile 'src\Cli\func\Azure.Functions.Cli.csproj' `
        -outputDirRoot '$(Build.ArtifactStagingDirectory)' `
        -commitHash '$(Build.SourceVersion)' `
        -integrationBuildNumber '$(Build.BuildNumber)'
    displayName: 'Publish CLI'
